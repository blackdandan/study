# PNG与JPG格式图片内存占用对比分析

## 基本原理

### PNG格式
```
PNG文件结构
├── 文件头 (8字节)        # 标识PNG文件
├── IHDR块               # 图像基本信息(宽、高、位深等)
├── 其他可选块           # 如调色板、透明度等
└── IDAT块               # 实际图像数据(使用DEFLATE算法压缩)
```

PNG采用无损压缩算法，支持透明度，适合保存需要精确还原的图像。

### JPG格式
```
JPG文件结构
├── SOI标记 (2字节)      # 文件开始
├── APPn标记段           # 应用数据
├── DQT标记段            # 量化表
├── SOF0标记段           # 帧开始(基本图像信息)
├── DHT标记段            # 哈夫曼表
├── SOS标记段            # 扫描开始
└── EOI标记 (2字节)      # 文件结束
```

JPG采用有损压缩算法，通过离散余弦变换(DCT)和量化减少文件大小。

## 内存占用计算

### 计算公式
```
内存占用 = 宽度 × 高度 × 每个像素的字节数
```

对于32位ARGB格式：
- PNG: 4字节/像素 (R,G,B,A各1字节)
- JPG: 3字节/像素 (R,G,B各1字节)

### 示例对比
```
640×480图片内存占用对比
├── PNG: 640×480×4 = 1,228,800字节 ≈ 1.17MB
└── JPG: 640×480×3 = 921,600字节 ≈ 0.88MB
```

## 影响因素

1. 图像尺寸：分辨率直接影响内存占用
2. 颜色深度：
   - PNG支持1/2/4/8/16位每通道
   - JPG通常使用8位每通道
3. 透明度：PNG支持alpha通道会增加内存
4. 压缩方式：
   - PNG使用DEFLATE压缩(不影响内存占用)
   - JPG使用DCT压缩(不影响内存占用)

## 实践问题与解决方案

### 问题1：PNG图片内存占用过高
解决方案：
- 对于不需要透明度的图片，使用JPG格式
- 降低分辨率或使用缩略图
- 使用RGB_565格式(2字节/像素)替代ARGB_8888

### 问题2：JPG图片质量损失明显
解决方案：
- 提高压缩质量参数(但会增加文件大小)
- 对需要精确还原的部分使用PNG格式
- 考虑使用WebP格式平衡质量和大小

## 面试相关问题

1. Q: 为什么PNG比JPG占用更多内存？
   A: PNG通常使用ARGB_8888格式(4字节/像素)，而JPG使用RGB格式(3字节/像素)，且PNG支持透明度。

2. Q: 如何优化图片内存占用？
   A: 根据使用场景选择合适的格式，使用适当的分辨率，考虑使用内存缓存和图片加载库(如Glide)。

3. Q: Bitmap.Config有哪些选项？如何影响内存？
   A: 
   ```
   Bitmap配置选项
   ├── ALPHA_8 (1字节/像素)   # 仅透明度
   ├── RGB_565 (2字节/像素)    # 无透明度
   ├── ARGB_4444 (2字节/像素) # 低质量透明度
   └── ARGB_8888 (4字节/像素) # 高质量透明度
   ```

## 相关设计模式

1. 策略模式：根据不同场景选择不同的图片解码策略
2. 享元模式：复用相同图片资源减少内存占用
3. 代理模式：使用占位图或缩略图延迟加载大图
